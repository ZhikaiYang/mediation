---
title: "Prepare data for Med analysis: learned from Zhikai"
author: "Jinliang Yang"
date: "09-23-2020"
output: NULL
---


## Normalize the path:

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE) 
knitr::opts_knit$set(root.dir=normalizePath('../../')) 
```


```{r}
library(glmnet)
library(MASS)
library(rrBLUP)
library(parallel)
library(doParallel)
library(CompQuadForm)

library(dplyr)
library("data.table")

source('lib/highmed2019.r')
source('lib/fromSKAT.R')
source('lib/MedWrapper.R')
source('lib/reporter.R')


rfile <- list.files(path="largedata/RNA-seq/", pattern="csv", full.names=TRUE)
trait <- read.delim("data/geno_trait.txt", header=T)
  
df <- data.frame(rnafile=rep(rfile, each=40), trait=rep(2:41, times=7))
write.table(df, "largedata/df_job_control.csv", sep=",", row.names=FALSE, quote=FALSE)


slurm_med_wrapper(ti=2, cutoff_pm=0.05, ncores=12,
                  phenofile = "data/geno_trait.txt",
                  genofile = "largedata/geno/allchr_bisnp_n282_snpid_maf01_geno2_pruned_NA_0_matrix.txt",
                  rnafile = "largedata/RNA-seq/filtered_GRoot.csv",
                  pcfile="largedata/allchr_bisnp_n282_snpid_maf01_geno2_pruned.eigenvec",
                  outdir="largedata/med_output")
  
```



