---
title: "Mediator genes break down by tissue"
author: "Jinliang Yang"
date: "1-21-2021"
output: NULL
---


## Normalize the path:

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE) 
knitr::opts_knit$set(root.dir=normalizePath('../../')) 
```


### Mediators

Note, here, we only focus on m1 (metabolite and morphological traits)
```{r}
library(data.table)

m <- read.csv("data/mediators_18812rows_by_cat.csv")
table(m$method)

### only consider std nitrogen condition
mi <- read.csv("cache/microbiome_mediators_34155rows.csv")

# res.eq
m1 <- subset(m, method %in% "res.fixed" & padj <= 0.05)
m1$type <- "Morphology"
m1[m1$category == "Metabolite", ]$type <- "Metabolite"


m2 <- subset(mi, treatment %in% "stdN" & method %in% "res.fixed" & padj <= 0.05)
m2$type <- "Microbiome"

m1 <- m1[, c("type", "category", "tissue", "trait", "id", "method", "e2m", "m2y","e2m2y","padj","coef")]
m2 <- m2[, c("type", "treatment", "tissue", "trait", "id", "method", "e2m", "m2y","e2m2y","padj","coef")]
names(m2)[2] <- "category"

df <- rbind(m1, m2) 
df <- m1

ag_name = fread("largedata/ag_name.txt")
metabolite_name = fread("largedata/metabolite_name.txt")
pheno_name = rbind(ag_name, metabolite_name)
m1 = merge(m1, pheno_name, by.x = "trait", by.y = "code_name")
m1 = m1[,-1]
colnames(m1)[11]="trait"
m1 <- m1[, c("type", "category", "tissue", "trait", "id", "method", "e2m", "m2y","e2m2y","padj","coef")]
m1$tissue <- factor(m1$tissue, levels = c( "GRoot", "GShoot", "L3Base", "L3Tip", "LMAD", "LMAN","Kern"),
                    labels =c( "Germinating root", "Germinating shoot", "Leaf 3 base", "Leaf 3 tip", "Adult leaf during the day", "Adult leaf at night","Kernels after pollination"))
```


# Polygenic mediators by tissue


Find the top mediators: "AC148152.3_FG005"


```{r}
fg5 <- subset(m1, id %in% "AC148152.3_FG005")

fg5m <- subset(fg5, type %in% "Metabolite")
#fg5m$value <- scale(fg5m$coef)

tissue <- unique(fg5m$tissue)
trait <- unique(fg5m$trait)
d <- data.frame(tissue=rep(tissue, times=length(trait)), trait=trait)
d$id <- paste(d$tissue, d$trait, sep="_")

fg5$id <- paste(fg5$tissue, fg5$trait, sep="_")

d <- merge(d, fg5[, c("id", "coef", "type")], by="id", all.x=TRUE)

library(scales)

d[is.na(d$coef),]$coef <- 0

#d$trait = gsub("X\\.[0-9]*\\.\\.", "", d$trait)
#d$trait= gsub("\\.\\.[0-9].*", "", d$trait)

```



```{r}
library(ggplot2)

fsize=18

# Heatmap 
pall <- ggplot(d, aes(tissue, trait, fill = coef)) + 
  geom_tile(colour='white') +
  scale_fill_gradientn(colours=c("red","white","darkgreen"),
                       values  = rescale(c(min(d$coef), 0, max(d$coef)))) +
    xlab("") +
    ylab("") +
    ggtitle("") +
    theme_classic() +
    labs(fill = "") +
    #scale_y_continuous(limits = c(-0.01, 1)) +
    theme(plot.title = element_text(size=20, face = "bold"), 
          axis.text=element_text(size=16, face="bold"),
          strip.text.x = element_text(size = 16, face = "bold"),
          axis.title=element_text(size=fsize, face="bold"),
          axis.text.x = element_text(angle = 15, hjust=0.8),
          #legend.position = c(0.2, 0.8), 
          legend.position ="none",
          legend.title = element_text(size=fsize, face="bold"),
          legend.text = element_text(size=13, face="bold"))
pall

pdf("graphs/rna_pheno_met_FG005_nol.pdf", width = 10, height= 6)
pall
dev.off()

```


# Polygenic mediators by tissue


Find the top mediators: "AC148152.3_FG005"


```{r}
fg5 <- subset(m1, id %in% "AC148152.3_FG005")

fg5a <- subset(fg5, type %in% "Morphology")
#fg5m$value <- scale(fg5m$coef)

tissue <- unique(fg5a$tissue)
trait <- unique(fg5a$trait)
d <- data.frame(tissue=rep(tissue, times=length(trait)), trait=trait)
d$id <- paste(d$tissue, d$trait, sep="_")

fg5$id <- paste(fg5$tissue, fg5$trait, sep="_")

d <- merge(d, fg5[, c("id", "coef", "type")], by="id", all.x=TRUE)

d[is.na(d$coef),]$coef <- 0
```



```{r}
library(ggplot2)

fsize=18

# Heatmap 
pall <- ggplot(d, aes(tissue, trait, fill = coef)) + 
  geom_tile(colour='white') +
  scale_fill_gradientn(colours=c("red","white","darkgreen"),
                       values  = rescale(c(min(d$coef), 0, max(d$coef)))) +
    xlab("") +
    ylab("") +
    ggtitle("") +
    theme_classic() +
    labs(fill = "") +
    #scale_y_continuous(limits = c(-0.01, 1)) +
    theme(plot.title = element_text(size=20, face = "bold"), 
          axis.text=element_text(size=16, face="bold"),
          strip.text.x = element_text(size = 16, face = "bold"),
          axis.title=element_text(size=fsize, face="bold"),
          axis.text.x = element_text(angle = 15, hjust=0.8),
          #legend.position = c(0.2, 0.8), 
          legend.position ="none",
          legend.title = element_text(size=fsize, face="bold"),
          legend.text = element_text(size=13, face="bold"))
pall

pdf("graphs/rna_pheno_ag_FG005_nol.pdf", width = 8.7, height= 6)
pall
dev.off()
```






Find the top mediators: "AC148152.3_FG001"


```{r}
fg1 <- subset(m1, id %in% "AC148152.3_FG001")

#fg1$value <- scale(fg1$coef)

tissue <- unique(fg1$tissue)
trait <- unique(fg1$trait)
d <- data.frame(tissue=rep(tissue, times=length(trait)), trait=trait)
d$id <- paste(d$tissue, d$trait, sep="_")

fg1$id <- paste(fg1$tissue, fg1$trait, sep="_")

d <- merge(d, fg1[, c("id", "coef", "type")], by="id", all.x=TRUE)

library(scales)

d[is.na(d$coef),]$coef <- 0
```



```{r}
library(ggplot2)

fsize=18

# Heatmap 
pall <- ggplot(d, aes(tissue, trait, fill = coef)) + 
  geom_tile(colour='white') +
  scale_fill_gradientn(colours=c("red","white","darkgreen"),
                       values  = rescale(c(min(d$coef), 0, max(d$coef)))) +
    xlab("") +
    ylab("") +
    ggtitle("") +
    theme_classic() +
    labs(fill = "") +
    #scale_y_continuous(limits = c(-0.01, 1)) +
    theme(plot.title = element_text(size=20, face = "bold"), 
          axis.text=element_text(size=16, face="bold"),
          strip.text.x = element_text(size = 16, face = "bold"),
          axis.title=element_text(size=fsize, face="bold"),
          axis.text.x = element_text(angle = 15, hjust=0.8),
          #legend.position = c(0.2, 0.8), 
          legend.position =c(0.8, 0.9),
          legend.title = element_text(size=fsize, face="bold"),
          legend.text = element_text(size=fsize))
pall

pdf("graphs/coef_FG001_alltraits.pdf", width = 9, height= 6)
pall
dev.off()
```




```{r}
fg1 <- subset(m1, id %in% "AC148152.3_FG001")

fg1m <- subset(fg1, type %in% "Metabolite")
#fg1m$value <- scale(fg1m$coef)

tissue <- unique(fg1m$tissue)
trait <- unique(fg1m$trait)
d <- data.frame(tissue=rep(tissue, times=length(trait)), trait=trait)
d$id <- paste(d$tissue, d$trait, sep="_")

fg1$id <- paste(fg1$tissue, fg1$trait, sep="_")

d <- merge(d, fg1[, c("id", "coef", "type")], by="id", all.x=TRUE)

library(scales)

d[is.na(d$coef),]$coef <- 0
```



```{r}
library(ggplot2)

fsize=18

# Heatmap 
pall <- ggplot(d, aes(tissue, trait, fill = coef)) + 
  geom_tile(colour='white') +
  scale_fill_gradientn(colours=c("red","white","darkgreen"),
                       values  = rescale(c(min(d$coef), 0, max(d$coef)))) +
    xlab("") +
    ylab("") +
    ggtitle("") +
    theme_classic() +
    labs(fill = "") +
    #scale_y_continuous(limits = c(-0.01, 1)) +
    theme(plot.title = element_text(size=20, face = "bold"), 
          axis.text=element_text(size=16, face="bold"),
          strip.text.x = element_text(size = 16, face = "bold"),
          axis.title=element_text(size=fsize, face="bold"),
          axis.text.x = element_text(angle = 15, hjust=0.8),
          #legend.position = c(0.2, 0.8), 
          legend.position =c(0.2, 0.2),
          legend.title = element_text(size=fsize, face="bold"),
          legend.text = element_text(size=fsize))
pall

pdf("graphs/coef_FG001_metabolite.pdf", width = 9, height= 6)
pall
dev.off()
```


# Polygenic mediators by tissue


Find the top mediators: "AC148152.3_FG001"


```{r}
fg1 <- subset(m1, id %in% "AC148152.3_FG001")

fg1a <- subset(fg1, type %in% "Morphology")
#fg1m$value <- scale(fg1m$coef)

tissue <- unique(fg1a$tissue)
trait <- unique(fg1a$trait)
d <- data.frame(tissue=rep(tissue, times=length(trait)), trait=trait)
d$id <- paste(d$tissue, d$trait, sep="_")

fg1$id <- paste(fg1$tissue, fg1$trait, sep="_")

d <- merge(d, fg1[, c("id", "coef", "type")], by="id", all.x=TRUE)

d[is.na(d$coef),]$coef <- 0
```



```{r}
library(ggplot2)

fsize=18

# Heatmap 
pall <- ggplot(d, aes(tissue, trait, fill = coef)) + 
  geom_tile(colour='white') +
  scale_fill_gradientn(colours=c("red","white","darkgreen"),
                       values  = rescale(c(min(d$coef), 0, max(d$coef)))) +
    xlab("") +
    ylab("") +
    ggtitle("") +
    theme_classic() +
    labs(fill = "") +
    #scale_y_continuous(limits = c(-0.01, 1)) +
    theme(plot.title = element_text(size=20, face = "bold"), 
          axis.text=element_text(size=16, face="bold"),
          strip.text.x = element_text(size = 16, face = "bold"),
          axis.title=element_text(size=fsize, face="bold"),
          axis.text.x = element_text(angle = 15, hjust=0.8),
          #legend.position = c(0.2, 0.8), 
          legend.position =c(0.2, 0.2),
          legend.title = element_text(size=fsize, face="bold"),
          legend.text = element_text(size=fsize))
pall

pdf("graphs/coef_FG001_ag.pdf", width = 9, height= 6)
pall
dev.off()
```

Find the top mediators: "AC148152.3_FG008"


```{r}
fg8 <- subset(m1, id %in% "AC148152.3_FG008")

#fg8$value <- scale(fg8$coef)

tissue <- unique(fg8$tissue)
trait <- unique(fg8$trait)
d <- data.frame(tissue=rep(tissue, times=length(trait)), trait=trait)
d$id <- paste(d$tissue, d$trait, sep="_")

fg8$id <- paste(fg8$tissue, fg8$trait, sep="_")

d <- merge(d, fg8[, c("id", "coef", "type")], by="id", all.x=TRUE)

library(scales)

d[is.na(d$coef),]$coef <- 0
```



```{r}
library(ggplot2)

fsize=18

# Heatmap 
pall <- ggplot(d, aes(tissue, trait, fill = coef)) + 
  geom_tile(colour='white') +
  scale_fill_gradientn(colours=c("red","white","darkgreen"),
                       values  = rescale(c(min(d$coef), 0, max(d$coef)))) +
    xlab("") +
    ylab("") +
    ggtitle("") +
    theme_classic() +
    labs(fill = "") +
    #scale_y_continuous(limits = c(-0.01, 1)) +
    theme(plot.title = element_text(size=20, face = "bold"), 
          axis.text=element_text(size=16, face="bold"),
          strip.text.x = element_text(size = 16, face = "bold"),
          axis.title=element_text(size=fsize, face="bold"),
          axis.text.x = element_text(angle = 15, hjust=0.8),
          #legend.position = c(0.2, 0.8), 
          legend.position =c(0.8, 0.9),
          legend.title = element_text(size=fsize, face="bold"),
          legend.text = element_text(size=fsize))
pall

pdf("graphs/coef_FG008_alltraits.pdf", width = 9, height= 6)
pall
dev.off()
```



```{r}
fg8 <- subset(m1, id %in% "AC148152.3_FG008")

fg8m <- subset(fg8, type %in% "Metabolite")
#fg8m$value <- scale(fg8m$coef)

tissue <- unique(fg8m$tissue)
trait <- unique(fg8m$trait)
d <- data.frame(tissue=rep(tissue, times=length(trait)), trait=trait)
d$id <- paste(d$tissue, d$trait, sep="_")

fg8$id <- paste(fg8$tissue, fg8$trait, sep="_")

d <- merge(d, fg8[, c("id", "coef", "type")], by="id", all.x=TRUE)

library(scales)

d[is.na(d$coef),]$coef <- 0
```



```{r}
library(ggplot2)

fsize=18

# Heatmap 
pall <- ggplot(d, aes(tissue, trait, fill = coef)) + 
  geom_tile(colour='white') +
  scale_fill_gradientn(colours=c("red","white","darkgreen"),
                       values  = rescale(c(min(d$coef), 0, max(d$coef)))) +
    xlab("") +
    ylab("") +
    ggtitle("") +
    theme_classic() +
    labs(fill = "") +
    #scale_y_continuous(limits = c(-0.01, 1)) +
    theme(plot.title = element_text(size=20, face = "bold"), 
          axis.text=element_text(size=16, face="bold"),
          strip.text.x = element_text(size = 16, face = "bold"),
          axis.title=element_text(size=fsize, face="bold"),
          axis.text.x = element_text(angle = 15, hjust=0.8),
          #legend.position = c(0.2, 0.8), 
          legend.position =c(0.2, 0.2),
          legend.title = element_text(size=fsize, face="bold"),
          legend.text = element_text(size=fsize))
pall

pdf("graphs/coef_FG008_metabolite.pdf", width = 9, height= 6)
pall
dev.off()
```


# Polygenic mediators by tissue


Find the top mediators: "AC148152.3_FG008"


```{r}
fg8 <- subset(m1, id %in% "AC148152.3_FG008")

fg8a <- subset(fg8, type %in% "Morphology")
#fg8m$value <- scale(fg8m$coef)

tissue <- unique(fg8a$tissue)
trait <- unique(fg8a$trait)
d <- data.frame(tissue=rep(tissue, times=length(trait)), trait=trait)
d$id <- paste(d$tissue, d$trait, sep="_")

fg8$id <- paste(fg8$tissue, fg8$trait, sep="_")

d <- merge(d, fg8[, c("id", "coef", "type")], by="id", all.x=TRUE)

d[is.na(d$coef),]$coef <- 0
```



```{r}
library(ggplot2)

fsize=18

# Heatmap 
pall <- ggplot(d, aes(tissue, trait, fill = coef)) + 
  geom_tile(colour='white') +
  scale_fill_gradientn(colours=c("red","white","darkgreen"),
                       values  = rescale(c(min(d$coef), 0, max(d$coef)))) +
    xlab("") +
    ylab("") +
    ggtitle("") +
    theme_classic() +
    labs(fill = "") +
    #scale_y_continuous(limits = c(-0.01, 1)) +
    theme(plot.title = element_text(size=20, face = "bold"), 
          axis.text=element_text(size=16, face="bold"),
          strip.text.x = element_text(size = 16, face = "bold"),
          axis.title=element_text(size=fsize, face="bold"),
          axis.text.x = element_text(angle = 15, hjust=0.8),
          #legend.position = c(0.2, 0.8), 
          legend.position =c(0.2, 0.2),
          legend.title = element_text(size=fsize, face="bold"),
          legend.text = element_text(size=fsize))
pall

pdf("graphs/coef_FG008_ag.pdf", width = 9, height= 6)
pall
dev.off()
```





